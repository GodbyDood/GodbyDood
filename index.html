<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Responsive Image with Scalable Hotspots</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div id="splash" role="dialog" aria-label="Intro splash" tabindex="0"></div>
    <div id="black-overlay" aria-hidden="true"></div>

    <main class="page hidden-content">
      <div class="frame">
        <svg id="hotspot-svg" viewBox="0 0 1170 2532" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Screenshot with hotspots">
          <image href="screenshot.png" x="0" y="0" width="1170" height="2532" preserveAspectRatio="xMidYMid meet"></image>

          <!-- Bottom row (160x160 each) -->
          <rect class="hotspot" id="hot-wrench"    x="188"  y="2203" width="187" height="203" data-key="wrench" tabindex="0" aria-label="Wrench button" />
          <rect class="hotspot" id="hot-calendar"  x="386"  y="2205" width="187" height="203" data-key="calendar" tabindex="0" aria-label="Calendar button" />
          <rect class="hotspot" id="hot-green"     x="586"  y="2205" width="187" height="203" data-key="green" tabindex="0" aria-label="Green button" />
          <rect class="hotspot" id="hot-yellow"    x="793"  y="2209" width="187" height="203" data-key="yellow" tabindex="0" aria-label="Yellow button" />

          <!-- Center row -->
          <rect class="hotspot" id="hot-pictochat" x="190"  y="1324" width="381" height="187" data-key="pictochat" tabindex="0" aria-label="PictoChat button" />
          <rect class="hotspot" id="hot-download"  x="597"  y="1324" width="383" height="195" data-key="download" tabindex="0" aria-label="DS Download/Play button" />

          <!-- Small center gray button -->
          <rect class="hotspot" id="hot-center-gray" x="542" y="1772" width="87" height="87" data-key="center-gray" tabindex="0" aria-label="Center gray button" />
        </svg>
      </div>
    </main>

    <!-- Audio players used by the splash sequence -->
    <audio id="confirm-audio" src="confirm.mp3" preload="auto" hidden></audio>
    <audio id="theme-audio" src="theme.mp3" loop preload="auto" hidden></audio>

    <script>
      (function () {
        // Utilities
        var $ = function (sel, root) { return (root || document).querySelector(sel); };

        // Hotspot behavior: simple visual feedback and activation handler
        function setupHotspots() {
          var hotspots = document.querySelectorAll('.hotspot');
          hotspots.forEach(function (el) {
            function activate() {
              el.classList.add('active');
              setTimeout(function () { el.classList.remove('active'); }, 220);
              // Placeholder for real action: replace with navigation, modal, etc.
              console.log('hotspot:', el.id, el.dataset.key);
            }

            el.addEventListener('click', activate);
            el.addEventListener('keydown', function (e) {
              if (e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar') { e.preventDefault(); activate(); }
            });
          });
        }

        // Helpful dev tool: log SVG coordinates when clicking the image (kept minimal)
        function setupSvgCoords() {
          var svg = $('#hotspot-svg');
          if (!svg) return;
          svg.addEventListener('click', function (e) {
            var pt = svg.createSVGPoint(); pt.x = e.clientX; pt.y = e.clientY;
            var svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
            console.log('svg coords:', Math.round(svgP.x), Math.round(svgP.y));
          });
        }

        // If the embedded image fails to load, show a simple SVG placeholder so hotspots are still visible.
        function setupImageFallback() {
          var imgHref = 'screenshot.png';
          var testImg = new Image();
          var svg = $('#hotspot-svg');
          if (!svg) return;
          var svgImage = svg.querySelector('image');

          testImg.onload = function () { console.log('Screenshot image loaded:', imgHref); };
          testImg.onerror = function () {
            if (svgImage) svgImage.style.display = 'none';
            var vb = svg.getAttribute('viewBox').split(' ');
            var w = +vb[2], h = +vb[3];
            var placeholder = document.createElementNS('http://www.w3.org/2000/svg','rect');
            placeholder.setAttribute('x','0'); placeholder.setAttribute('y','0');
            placeholder.setAttribute('width', w); placeholder.setAttribute('height', h);
            placeholder.setAttribute('fill','#efefef'); placeholder.setAttribute('stroke','#ccc'); placeholder.setAttribute('stroke-width','4');
            svg.insertBefore(placeholder, svg.firstChild);

            var txt = document.createElementNS('http://www.w3.org/2000/svg','text');
            txt.setAttribute('x', w/2); txt.setAttribute('y', h/2 - 20); txt.setAttribute('text-anchor','middle');
            txt.setAttribute('fill','#666'); txt.setAttribute('font-size','40'); txt.textContent = 'Missing image: ' + imgHref;
            svg.appendChild(txt);
          };
          testImg.src = imgHref;
        }

        // Splash + audio sequence
        function setupSplash() {
          var splash = document.getElementById('splash');
          var black = document.getElementById('black-overlay');
          var main = document.querySelector('main.page');
          var confirm = document.getElementById('confirm-audio');
          var theme = document.getElementById('theme-audio');
          if (!splash || !black || !main) return;

          splash.style.opacity = '1';

          function startThemeAudio() {
            if (!theme) return;
            theme.volume = 0.5;
            var p = theme.play();
            if (p && p.catch) {
              p.catch(function () {
                // Autoplay blocked â€” start on next user interaction
                function tryStart() { theme.play().catch(function (){}); window.removeEventListener('pointerdown', tryStart); window.removeEventListener('keydown', tryStart); }
                window.addEventListener('pointerdown', tryStart, { once: true });
                window.addEventListener('keydown', tryStart, { once: true });
              });
            }
          }

          function onSplashActivate() {
            if (confirm) { confirm.volume = 0.01; confirm.currentTime = 0; confirm.play().catch(function(){}); }
            black.style.display = 'block';
            requestAnimationFrame(function () { black.style.opacity = '1'; splash.style.opacity = '0'; });

            setTimeout(function () {
              splash.style.display = 'none';
              main.classList.remove('hidden-content');
              requestAnimationFrame(function () { black.style.opacity = '0'; });
              setTimeout(function () { black.style.display = 'none'; startThemeAudio(); }, 500);
            }, 500);
          }

          splash.addEventListener('click', onSplashActivate, { once: true });
          splash.addEventListener('keydown', function (e) { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onSplashActivate(); } }, { once: true });
        }

        // init
        document.addEventListener('DOMContentLoaded', function () {
          setupHotspots(); setupSvgCoords(); setupImageFallback(); setupSplash();
        });
      })();
    </script>
  </body>
</html>
